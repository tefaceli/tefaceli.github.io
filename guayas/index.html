<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8' />
    <title>En Guayas, una persona es asesinada cada dos horas en promedio</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <link rel="icon" type="image/x-icon"
        href="https://raw.githubusercontent.com/mapbox/assembly/publisher-staging/src/svgs/mapbox.svg">
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v3.8.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v3.8.0/mapbox-gl.css' rel='stylesheet' />
    <script src="https://cdn.jsdelivr.net/npm/mapbox-gl-globe-minimap@1.2.0/dist/bundle.js"></script>
    <script src="https://unpkg.com/scrollama"></script>
    <style>
        html, body {
            overflow-x: hidden;
            margin: 0;
            padding: 0;
            width: 100%;
        }
        body {
            font-family: sans-serif;
            margin: 0;
            padding: 0;
            width: 100%;
        }
        a,
        a:hover,
        a:visited {
            color: #0071bc;
        }
        /* Custom height logic for iframe embedding */
        #map {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 0;
            height: 100vh;
        }
        .c-body--jugada #map {height: 100vh;}
        @media (max-width: 1199px) { .c-body--jugada #map {height: 100vh;}  }
        @media (max-width: 991px) { .c-body--jugada #map {height: 100vh;}  }
        @media (max-width: 1023px) { #map {height: 100vh;}  }
        @media (max-width: 768px) {  #map {height: 100vh; }.c-body--jugada #map {height: 100vh;}  }
        /* Hide elements for embed if needed */
        footer, .c-add, .c-detail_title_h1, #taboola-mid-article-thumbnails-stream, #taboola-below-article-thumbnails, #taboola-below-article-thumbnails-1,  .o-section[data-url="/deportes/estadistica-deportes-73926/"] {
        display: none !important;
        }
        main .o-container {max-width: 100% !important;}
        @media (max-width: 767px) {.c-detail {padding-top: 0;}}
        main .o-section{margin:0}
        .trc_related_container {display:none}
        /* ...existing code... */
        #intro {
            padding: 0;
            padding-bottom: 20px;
            background: white;
            z-index: 2;
            position: relative;
            text-align: center;
        }
        #intro h1 {
            position: relative;
            font-size: 2.5rem;
            margin: 0;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 6px rgba(0,0,0,0.6);
            z-index: 1;
            text-align: center;
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 0 20px;
            box-sizing: border-box;
        }
        #intro h1::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url("https://imagenes.primicias.ec/files/content_image_simple_583_325/uploads/2025/09/12/68c42ec27beb9.jpeg") center/cover no-repeat;
            z-index: -1;
            opacity: 0.7;
            padding: 0 20px;
        }

        #intro h1 .byline {
            font-size: 1rem;
            font-weight: normal;
            margin-top: 10px;
            color: #fff;
        }

        #intro h1 .caption {
            position: absolute;
            bottom: 10px;
            left: 10px;
            font-size: 0.5em;
            font-style: italic;
            color: rgba(255, 255, 255, 0.8);
            text-shadow: 1px 1px 3px rgba(0,0,0,0.6);
            z-index: 2;
            text-align: left;
        }

        #intro h2 {
            font-size: 1.7em;
            margin: 20px auto;
            font-weight: bold;
            color: #555;
            padding-bottom: 20px;
        }

        #intro p {
            font-size: 1.2em;
            line-height: 1.3;
            margin-bottom: 1em;
            margin-left: auto;
            margin-right: auto;
        }

        #intro h2,
        #intro p {
            max-width: 800px;
            padding: 0 20px;
            text-align: center;
        }

        #story-wrapper {
            position: relative;
            padding-top: 20vh;
        }

        #map {
            position: fixed;
            top: 0;
            width: 100%;
            height: 100vh;
            z-index: 0;
        }

        #story {
            position: relative;
            z-index: 1;
        }

        #footer {
            width: 100%;
            min-height: 5vh;
            padding-top: 2vh;
            padding-bottom: 2vh;
            text-align: left;
            line-height: 25px;
            font-size: 13px;
            position: relative;
            z-index: 5;
        }

        #footer p {
            text-align: left;
            margin-left: auto;
            margin-right: auto;
            max-width: 700px;
            padding: 0 16px;
        }

        #features {
            padding-top: 10vh;
            padding-bottom: 10vh;
        }

        .hidden {
            visibility: hidden;
        }

        .centered {
            width: 50%;
            margin: 0 auto;
        }

        .lefty {
            width: 33vw;
            margin-left: 5vw;
        }

        .righty {
            width: 33vw;
            margin-left: 62vw;
        }

        .fully {
            width: 100%;
            margin: auto;
        }

        .light {
            color: #444;
            background-color: #fafafa;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .dark {
            color: #fafafa;
            background-color: #444;
        }

        .step {
            padding: 50vh 20px 50vh 20px;
            /* margin-bottom: 10vh; */
            opacity: 1;
        }

        .step h3 {
            font-size: 1.8em;
            margin-bottom: 12px;
            font-weight: bold;
            color: #222;
        }

        .step p {
            font-size: 1.2em;
            line-height: 1.6;
            color: #333;
            margin-bottom: 0;
        }

        .step.active {
            opacity: 1;
        }

        .step div {
            padding: 25px 50px;
            line-height: 25px;
            font-size: 13px;
        }

        .step img {
            width: 100%;
        }

        .chart-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: left;
        }


        @media (max-width: 750px) {
            #intro h1 {
                padding: 0 10px;
                line-height: 1.2em;
                font-size: 2rem;
            }
        
            #intro h2,
            #intro p {
                max-width: 100%;
                padding: 0 15px;
                font-size: 1.1em;
            }

            .step h3 {
                font-size: 1.5em;
            }
            .step p {
                font-size: 1em;
            }

            .centered,
            .lefty,
            .righty,
            .fully {
                width: 90vw;
                margin: 0 auto;
            }
        }

        .mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,
        .mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas {
            touch-action: unset;
        }
    </style>
</head>
<script>
function sendHeight() {
  if (window.parent !== window) {
    window.parent.postMessage(
      { type: 'setIframeHeight', height: document.body.scrollHeight },
      '*'
    );
  }
}
window.addEventListener('load', sendHeight);
window.addEventListener('resize', sendHeight);
// If your content changes dynamically, you can also use a MutationObserver:
const observer = new MutationObserver(sendHeight);
observer.observe(document.body, { childList: true, subtree: true, attributes: true });
</script>
<body>
    <!-- INTRO -->
    <section id="intro">
        <h1>
            ¿Qué tan cercana es la crisis de violencia en Guayas? Este es el mapa de los crímenes por parroquias
            <span class="byline">Por: Estefanía Celi <br>14 de agosto de 2025</span>
        </h1>
        <span class="caption"><i>Foto: César Muñoz / API</i></span>

        <h2>
            Entre enero y julio de 2025, la provincia de Guayas ha registrado 2.547 asesinatos, 
            que corresponden al 48% de todas las muertes violentas registradas en el país. En Guayaquil, 
            no ha habido un día sin, al menos, un homicidio en los primeros siete meses de 2025.
        </h2>

        <p>
            El año 2025 se va configurando como el más violento para Guayas en los últimos años. La provincia, que es 
            también la más poblada de Ecuador, con 4,3 millones de habitantes según el censo de 2022, suma ya 2.547 muertes violentas,
            según <a href="https://www.primicias.ec/seguridad/guayas-manabi-mayor-concentracion-violencia-criminal-disputa-territorial-ecuador-103430/">
            el último reporte del Ministerio del Interior</a>. 
        </p>

        <p>
            Con estas cifras, Guayas concentra el 48% de los asesinatos en los primeros siete meses 
            de 2025. Esto significa que en promedio una persona es asesinada cada 119 minutos.
        </p>

        <p><iframe title="Las muertes violentas en Ecuador por provincia" aria-label="Gráfico de círculo" id="datawrapper-chart-EvVTW" src="https://datawrapper.dwcdn.net/EvVTW/1/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="546" data-external="1"></iframe><script type="text/javascript">!function(){"use strict";window.addEventListener("message",function(a){if(void 0!==a.data["datawrapper-height"]){var e=document.querySelectorAll("iframe");for(var t in a.data["datawrapper-height"])for(var r,i=0;r=e[i];i++)if(r.contentWindow===a.source){var d=a.data["datawrapper-height"][t]+"px";r.style.height=d}}})}();
                </script>
        </p>

        <p>Pero la violencia dentro de Guayas se siente más cercana. Es por ello que PRIMICIAS ha buscado llevar el análisis
            de las cifras de muertes violentas a una escala más pequeña: a las parroquias y los barrios. Es allí donde los
            habitantes sienten los estragos de la crisis, oyendo los disparos en casas de vecinos, escuchando la historia de otro
            conocido muerto... 
        </p>

        <p><i>Deslice para ver más información</i></p>

    </section>

    <!-- SCROLLYTELLING -->
    <div id="story-wrapper" style="height: 100%; min-height: 100%;">
        <div id="map"></div>
        <div id="story" style="position: relative; z-index: 1;"></div>
    </div>

    <script src="./config.js"></script>
    <script>
        // Listen for postMessage events for map control
        window.addEventListener('message', function(event) {
            // Optionally check event.origin for security
            const { action, payload } = event.data || {};
            if (!action) return;
            if (typeof map === 'undefined') return;
            if (action === 'moveTo' && payload) {
                // payload: {lat, lng, zoom}
                map.flyTo({center: [payload.lng, payload.lat], zoom: payload.zoom});
            }
            if (action === 'setLayerVisibility' && payload) {
                // payload: {layerId, visibility}
                map.setLayoutProperty(payload.layerId, 'visibility', payload.visibility);
            }
            // Add more actions as needed
        });
        var initLoad = true;
        var layerTypes = {
            'fill': ['fill-opacity'],
            'line': ['line-opacity'],
            'circle': ['circle-opacity', 'circle-stroke-opacity'],
            'symbol': ['icon-opacity', 'text-opacity'],
            'raster': ['raster-opacity'],
            'fill-extrusion': ['fill-extrusion-opacity'],
            'heatmap': ['heatmap-opacity']
        }

        var alignments = {
            'left': 'lefty',
            'center': 'centered',
            'right': 'righty',
            'full': 'fully'
        }

        function getLayerPaintType(layer) {
            var layerType = map.getLayer(layer).type;
            return layerTypes[layerType];
        }

        function setLayerOpacity(layer) {
            var paintProps = getLayerPaintType(layer.layer);
            paintProps.forEach(function (prop) {
                var options = {};
                if (layer.duration) {
                    var transitionProp = prop + "-transition";
                    options = { "duration": layer.duration };
                    map.setPaintProperty(layer.layer, transitionProp, options);
                }
                map.setPaintProperty(layer.layer, prop, layer.opacity, options);
            });
        }

        var story = document.getElementById('story');
        var features = document.createElement('div');
        features.setAttribute('id', 'features');

        config.chapters.forEach((record, idx) => {
            var container = document.createElement('div');
            var chapter = document.createElement('div');

            if (record.title) {
                var title = document.createElement('h3');
                title.innerText = record.title;
                chapter.appendChild(title);
            }

            if (record.image) {
                var image = new Image();
                image.src = record.image;
                chapter.appendChild(image);
            }

            if (record.description) {
                var story = document.createElement('p');
                story.innerHTML = record.description;
                chapter.appendChild(story);
            }

            container.setAttribute('id', record.id);
            container.classList.add('step');
            if (idx === 0) {
                container.classList.add('active');
            }

            chapter.classList.add(config.theme);
            container.appendChild(chapter);
            container.classList.add(alignments[record.alignment] || 'centered');
            if (record.hidden) {
                container.classList.add('hidden');
            }
            features.appendChild(container);
        });

    story.appendChild(features);

        var footer = document.createElement('div');

        if (config.footer) {
            var footerText = document.createElement('p');
            footerText.innerHTML = config.footer;
            footer.appendChild(footerText);
        }

        if (footer.innerText.length > 0) {
            footer.classList.add(config.theme);
            footer.setAttribute('id', 'footer');
            story.appendChild(footer);
        }

        mapboxgl.accessToken = config.accessToken;

        var map = new mapboxgl.Map({
            container: 'map',
            style: config.style,
            center: config.chapters[0].location.center,
            zoom: config.chapters[0].location.zoom,
            bearing: config.chapters[0].location.bearing,
            pitch: config.chapters[0].location.pitch,
            interactive: false,
            projection: config.projection
        });

        if (config.inset) {
            map.addControl(
                new GlobeMinimap({ ...config.insetOptions }),
                config.insetPosition
            );
        }

        if (config.showMarkers) {
            var marker = new mapboxgl.Marker({ color: config.markerColor });
            marker.setLngLat(config.chapters[0].location.center).addTo(map);
        }

        var scroller = scrollama();


        map.on("load", function () {
            if (config.use3dTerrain) {
                map.addSource('mapbox-dem', {
                    'type': 'raster-dem',
                    'url': 'mapbox://mapbox.mapbox-terrain-dem-v1',
                    'tileSize': 512,
                    'maxzoom': 14
                });
                map.setTerrain({ 'source': 'mapbox-dem', 'exaggeration': 1.5 });
            };

            scroller
                .setup({
                    step: '.step',
                    offset: 0.5,
                    progress: true,
                    container: 'body',
                    graphic: '#map',
                    text: '#story'
                })
                .onStepEnter(async response => {
                    var current_chapter = config.chapters.findIndex(chap => chap.id === response.element.id);
                    var chapter = config.chapters[current_chapter];

                    response.element.classList.add('active');
                    map[chapter.mapAnimation || 'flyTo'](chapter.location);

                    if (config.showMarkers) {
                        marker.setLngLat(chapter.location.center);
                    }
                    if (chapter.onChapterEnter.length > 0) {
                        chapter.onChapterEnter.forEach(setLayerOpacity);
                    }
                    if (chapter.callback) {
                        window[chapter.callback]();
                    }
                    if (chapter.rotateAnimation) {
                        map.once('moveend', () => {
                            const rotateNumber = map.getBearing();
                            map.rotateTo(rotateNumber + 180, {
                                duration: 30000, easing: function (t) {
                                    return t;
                                }
                            });
                        });
                    }
                    if (config.auto) {
                        var next_chapter = (current_chapter + 1) % config.chapters.length;
                        map.once('moveend', () => {
                            document.querySelectorAll('[data-scrollama-index="' + next_chapter.toString() + '"]')[0].scrollIntoView();
                        });
                    }
                })
                .onStepExit(response => {
                    var chapter = config.chapters.find(chap => chap.id === response.element.id);
                    response.element.classList.remove('active');
                    if (chapter.onChapterExit.length > 0) {
                        chapter.onChapterExit.forEach(setLayerOpacity);
                    }
                });


            if (config.auto) {
                document.querySelectorAll('[data-scrollama-index="0"]')[0].scrollIntoView();
            }
        });    

        </script>
        <!-- TEST: Show scrollable height for debugging -->
        <script>
            // Add a fixed bar at the bottom showing the scroll height and window height
            const bar = document.createElement('div');
            bar.style.position = 'fixed';
            bar.style.left = '0';
            bar.style.bottom = '0';
            bar.style.width = '100vw';
            bar.style.background = 'rgba(0,0,0,0.7)';
            bar.style.color = 'white';
            bar.style.fontSize = '14px';
            bar.style.zIndex = '9999';
            bar.style.pointerEvents = 'none';
            bar.style.textAlign = 'center';
            function updateBar() {
                bar.textContent = `Scroll height: ${document.body.scrollHeight}px | Window height: ${window.innerHeight}px`;
            }
            updateBar();
            window.addEventListener('resize', updateBar);
            window.addEventListener('scroll', updateBar);
            document.body.appendChild(bar);
        </script>

</body>

</html>